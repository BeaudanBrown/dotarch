#!/bin/bash

[[ -z $1 ]] && exit
[[ -z $2 ]] && exit
appName=$1
workspaceName=$2
if [ -z $3 ]; then
  windowName=$appName
else
  windowName=$3
fi

term=false
[[ $appName = "st" ]] && term=true

if ! >/dev/null pgrep -i $appName || ! wmctrl -lx | grep -q -i $windowName; then
  # App isn't open
  echo 'Opening app'
  bspc monitor primary -a $workspaceName
  bspc desktop -f $workspaceName
  if [ $windowName = $TERMINAL ]; then
      $TERMINAL -T $appName
  else
      $appName -T $appName
  fi
fi

currentWorkspace=$( bspc query -D -d focused --names )
if [[ "$currentWorkspace" == "$workspaceName" ]]; then
  # If workspace is already focused, switch to the last used workspace
  echo 'Leaving app workspace'
  bspc desktop -f last
  exit
fi

# We know app is running on different workspace
echo 'Switching to app workspace'
wmctrl -x -a $windowName
