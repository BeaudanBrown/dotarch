#!/bin/bash

[[ -z $1 ]] && exit
[[ -z $2 ]] && exit
appName=$1
workspaceName=$2
if [ -z $3 ]; then
  windowName=$appName
else
  windowName=$3
fi

if ! >/dev/null pgrep -i $appName || ! wmctrl -lx | grep -q -i $windowName; then
  # App isn't open
  echo 'Opening app'
  i3 workspace $workspaceName
  $appName -T $appName &
  exit
fi

currentWorkspace=$( i3-msg -t get_workspaces | jq '.[] | select(.focused) | .name' | stripquotes )
if [[ "$currentWorkspace" == "$workspaceName" ]]; then
  # If workspace is already focused, switch to the last used workspace
  echo 'Leaving app workspace'
  i3 workspace back_and_forth
  exit
fi

# We know app is running on different workspace
echo 'Switching to app workspace'
wmctrl -x -a $windowName
